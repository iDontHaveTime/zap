name: Discord Notifications

on:
  push:
    branches: [ main ]

jobs:
  discord:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Get short SHA
        id: vars
        run: echo "sha_short=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT

      - name: Discord notification
        uses: appleboy/discord-action@master
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          color: "#5865F2"
          username: "GitHub Actions"
          message: |
            **[${{ github.ref_name }}] New commit by ${{ github.actor }}
            `${{ steps.vars.outputs.sha_short }}` ${{ github.event.head_commit.message }}
            [View Commit](${{ github.event.repository.html_url }}/commit/${{ github.sha }})
